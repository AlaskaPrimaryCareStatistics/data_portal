nps <- rep(NA, length(lev))
for (i in 1:length(lev)){
nps[i] <- length(unique(d$mrn[d[,ovar]==lev[i]]))
}
times <- list()
d <- d[d$covid=="Y",]
for (i in 1:length(lev)){
times[[i]] <- d$time[d[,ovar]==lev[i]]
}
names(times) <- lev
# extract dates #
d1 <- dr[1]
d2 <- dr[2]
d1 <- as.POSIXct(d1, format="%y-%m-%d")
d2 <- as.POSIXct(d2, format="%y-%m-%d")
data <- data[data$date >= d1 & data$date <= d2,]
dates <- unique(as.character(sort(data$date), format="%m/%Y"))
if (ovar=="center"){
plot_surv(times, nps, dates, ovar, ylim=ylim, lx="bottomleft", leg=F)
}else{
plot_surv(times, nps, dates, ovar, ylim=ylim, lx="bottomleft", leg=T)
}
}
runApp()
print(d)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
data_vaccination
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp('C:/Users/19708/Desktop/APCA/R/skeletons/Shiny/persistent')
runApp('C:/Users/19708/Desktop/data_portal')
shiny::runApp('C:/Users/19708/Desktop/APCA/R/skeletons/Shiny/persistent')
runApp()
# End Trading Routine #
# $$$$$$$$$$$$$$$$$$$ #
pause_foot(ni, i, pause[2], units[2])
runApp()
runApp()
runApp()
runApp()
runApp('C:/Users/19708/Desktop/APCA/R/skeletons/Shiny/persistent')
shiny::runApp()
shiny::runApp()
rm(list=objects())
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
rm(list=objects())
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
# function to pull params
thetas <- pull_thetas("ETH")
runApp()
runApp()
# Existing code #
#' @param times
#' list of vectors;
#'    each vector stores encounter times;
#'    names(list) = variable names over which data is stratified
#' @param nps
#' (vector) number of patients associated with stratification variables
plot_surv <- function(times, nps, dates, var, ylim, lx, leg){
for (i in 1:length(times)){
sf <- surv_fun(times[[i]], nps[i])
# from nps and sf backout SE #
# Insert Plotting Code #
cols <- c("red", "green", "pink", "yellow", "#FF8000", "#80FF00", "cyan", "#0080FF", "#8000FF", "magenta", "#FF0080","blue")
lwd=4
if (i==1){
plot(sf[,1], sf[,3], ty="l", col=cols, ylim=ylim, xlab=NA, ylab=NA, main=paste("by", stringr::str_to_title(var)), xaxt="n")
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = "grey10") # Color
lines(c(-1, 50), c(0,0))
lines(c(-1, 50), c(0.10, 0.10))
lines(c(-1, 50), c(0.20, 0.20))
lines(c(-1, 50), c(0.30, 0.30))
lines(c(-1, 50), c(0.40, 0.40))
lines(c(-1, 50), c(0.50, 0.50))
lines(c(-1, 50), c(0.60, 0.60))
lines(c(-1, 50), c(0.70, 0.70))
lines(c(-1, 50), c(0.80, 0.80))
lines(c(-1, 50), c(0.90, 0.90))
lines(c(-1, 50), c(1, 1))
axis(1, at=1:length(dates), dates)
lines(sf[,1], sf[,3], col=cols[i], lwd=lwd)
name_v <- names(times)
if (isTRUE(leg)){
legend(
lx,
ly,
bg="grey10",
name_v,
cex = 1.25,
col=cols[1:length(name_v)],
lty=1,
lwd=4,
text.col=cols[1:length(name_v)]
)
}
}else{
lines(sf[,1], sf[,3], ty="l", col=cols[i], lwd=lwd)
}
}
}
# goof around with some survival analysis #
#' @param times vector of encounter times
#' @param np number of patients seen
surv_fun <- function(times, np){
df <- data.frame(
time = 1:max(times),
cov = rep(NA, length(1:max(times))),
sur = rep(NA, length(1:max(times)))
)
for (t in 1:max(times)){
df$cov[t] <- sum(na.omit(times==t))
}
for (t in max(times):1){
df$sur[t] <- (np-sum(df$cov[1:t]))/np
print(sum(df$cov[1:t]))
}
return(df)
}
runApp()
print(np-sum(df$cov[1:t]))
runApp()
runApp()
runApp()
runApp()
runApp()
hi <- sf$sur+1.96*se
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
#### Load Libraries and Helper Functions #####
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
str(data_covid$race)
str(data_vaccination)
str(data_vaccination$race)
str(data_vaccination$race)
str(data_telehealth$race)
data_covid$race <- as.character(data_covid$race)
data_vaccination$race <- as.character(data_vaccination$race)
data_telehealth$race <- as.character(data_telehealth$race)
data_covid$race[data_covid$race=="Native"] <- "Native Alaskan"
data_vaccination$race[data_vaccination$race=="Native"] <- "Native Alaskan"
data_telehealth$race[data_telehealth$race=="Native"] <- "Native Alaskan"
unique(data_covid$race)
l <- c("White", "Native Alaskan", "Asian", "Black", "Other")
l <- c("White", "Native Alaskan", "Asian", "Black", "Other")
data_covid$race <- factor(data_covid$race, levels = l)
data_vaccination$race <- factor(data_covid$race, levels = l)
data_vaccination$race <- factor(data_vaccination$race, levels = l)
data_telehealth$race <- factor(data_telehealth$race, levels=l)
choose.dir
choose.dir()
setwd("C:/Users/19708/Desktop/data_portal/rds")
setwd("C:/Users/19708/Desktop/data_portal/rds")
save(data_covid, file = "covid.rds")
save(data_vaccination, file = "vaccination.rds")
save(data_telehealth, file = "telehealth.rds")
runApp('C:/Users/19708/Desktop/data_portal')
data_covid
data_covid[,3]
data_vaccination[,3]
data_telehealth[,3]
data_vaccination$[,6]
data_vaccination[,6]
data_covid[,-3]
data_covid <- data_covid[,-3]
data_vaccination <- data_vaccination[,-6]
data_telehealth <- data_telehealth[,-3]
getwd()
save(data_covid, file = "covid.rds")
save(data_vaccination, file = "vaccination.rds")
save(data_telehealth, file = "telehealth.rds")
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
rm(list=objects())
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
help(src)
help(img)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
getwd()
setwd("xlsx")
readxl::read_xlsx("Organizations.xlsx")
Sites <- readxl::read_xlsx("Sites.xlsx")
setwd("../rda")
save(Organizations, file="Organizations.rda")
Organizations <- readxl::read_xlsx("Organizations.xlsx")
save(Organizations, file="Organizations.rda")
save(Sites, file="Sites.rda")
rm(list=objects())
#### Load Libraries and Helper Functions #####
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
#### Load Libraries and Helper Functions #####
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
##### Global Variables #####
{
strat_choices <- c("Age","Sex","Race","Ethnicity","Language","Insurance Class","Alcohol Use Disorder","Depression Diagnosis","Tobacco Use")
}
setwd("xlsx")
Organizations <- readxl::read_xlsx("Organizations.xlsx")
Sites <- readxl::read_xlsx("Sites.xlsx")
setwd("../rds")
save(Organizations, file="Organizations.rda")
save(Sites, file="Sites.rda")
rm(list=objects())
#### Load Libraries and Helper Functions #####
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
##### Global Variables #####
{
strat_choices <- c("Age","Sex","Race","Ethnicity","Language","Insurance Class","Alcohol Use Disorder","Depression Diagnosis","Tobacco Use")
}
head(Sites)
runApp()
runApp()
runApp()
runApp()
runApp()
Organizations$ORGANIZATION_NAME
c("All", Organizations$ORGANIZATION_NAME)
runApp()
runApp()
runApp()
runApp()
#' @param data
#' @param organization
landing_map <- function(Sites, organization){
if (organization == "All"){
mapData <- Sites
}else{
org_id <- Organizations$ORGANIZATION_ID[Organizations$ORGANIZATION_NAME==organization]
mapData <- Sites[Sites$ORGANIZATION_ID==org_id]
}
leaflet() %>%
addTiles() %>%
addMarkers(data = mapData, lng = ~LONGITUDE, lat = ~LATITUDE, popup = ~SITE_NAME)
}
Sites
Sites
landing_map(Sites, "All")
#' @param data
#' @param organization
landing_map <- function(Sites, organization){
if (organization == "All"){
mapData <- Sites
}else{
org_id <- Organizations$ORGANIZATION_ID[Organizations$ORGANIZATION_NAME==organization]
mapData <- Sites[Sites$ORGANIZATION_ID==org_id]
}
print(mapData)
leaflet() %>%
addTiles() %>%
addMarkers(data = mapData, lng = ~LONGITUDE, lat = ~LATITUDE, popup = ~SITE_NAME)
}
landing_map(Sites, "All")
landing_map(Sites, Sites$SITE_NAME[1])
landing_map(Sites, Sites$SITE_NAME[1])
landing_map(Sites, Organizations$ORGANIZATION_NAME[1])
Organizations$ORGANIZATION_NAME[1]
landing_map(Sites, 1)
landing_map(Sites, 1)
org_id <- 1
mapData <- Sites[Sites$ORGANIZATION_ID==org_id]
#' @param data
#' @param organization
landing_map <- function(Sites, organization){
if (organization == "All"){
mapData <- Sites
}else{
org_id <- Organizations$ORGANIZATION_ID[Organizations$ORGANIZATION_NAME==organization]
mapData <- Sites[Sites$ORGANIZATION_ID==org_id,]
}
leaflet() %>%
addTiles() %>%
addMarkers(data = mapData, lng = ~LONGITUDE, lat = ~LATITUDE, popup = ~SITE_NAME)
}
runApp()
runApp()
dev.off()
dev.off()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
#### Load Libraries and Helper Functions #####
{
library(shiny)
library(shinydashboard)
library(leaflet)
library(dplyr)
library(mailtoR)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
data_telehealth
runApp()
rm(list=objects())
source("C:/Users/19708/Desktop/APCA/R/jordy_tools/combine_files.R")
rm(list=objects())
source("C:/Users/19708/Desktop/APCA/R/jordy_tools/combine_files.R")
all_cov <- combine_files("C:/Users/19708/Desktop/hccn_pca_arpa/main_proj/data/covid")
shiny::runApp()
runApp()
runApp()
runApp()
if (organization == "All"){
mapData <- Sites
}else{
org_id <- Organizations$ORGANIZATION_ID[Organizations$ORGANIZATION_NAME==organization]
mapData <- Sites[Sites$ORGANIZATION_ID==org_id,]
}
shiny::runApp()

ly,
bg="grey10",
name_v,
cex = 1.25,
col=cols[1:length(name_v)],
lty=1,
lwd=4,
text.col=cols[1:length(name_v)]
)
}
}else{
lines(sf[,1], sf[,3], ty="l", col=cols[i], lwd=lwd)
}
}
}
if (ovar=="center"){
plot_surv(times, nps, dates, ovar, lx="bottomleft", leg=F)
}else{
plot_surv(times, nps, dates, ovar, lx="bottomleft", leg=T)
}
ly
rm(list=objects())
#### Load Libraries and Helper Functions #####
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
survival_plot(
data <- data_covid,
xvar <- "time",
yvar <- "covid",
ovar <- "age",
dr <- c(
"21-01-01",
"21/08/01"
),
ylim <- c(0, 1)
)
rm(list=objects())
rm(list=objects())
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
survival_plot(
data <- data_covid,
xvar <- "time",
yvar <- "covid",
ovar <- "age",
dr <- c(
"21-01-01",
"21/08/01"
),
ylim <- c(0, 1)
)
rm(list=objects())
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
survival_plot(
data <- data_covid,
xvar <- "time",
yvar <- "covid",
ovar <- "age",
dr <- c(
"21-01-01",
"21/08/01"
),
ylim <- c(0, 1)
)
rm(list=objects())
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
survival_plot(
data <- data_covid,
xvar <- "time",
yvar <- "covid",
ovar <- "age",
dr <- c(
"21-01-01",
"21/08/01"
),
ylim <- c(0, 1)
)
rm(list=objects())
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
survival_plot(
data <- data_covid,
xvar <- "time",
yvar <- "covid",
ovar <- "age",
dr <- c(
"21-01-01",
"21/08/01"
),
ylim <- c(0, 1)
)
runApp()
runApp()
runApp()
runApp()
#' @param data main data table
#' @param xvar x-axis variable -- will generally be time
#' @param yvar y-axis variable -- e.g., covid or vaccinated
#' @param ovar user input stratification variable
#' @param dr user input daterange
#' @param ylim user input y range
survival_plot <- function(data, xvar, yvar, ovar, dr, ylim){
if (ovar == "Health Center"){
ovar <- "center"
}
if (ovar == "Age"){
ovar <- "age"
legend <- "Y"
}
if (ovar == "Sex"){
ovar <- "sex"
legend <- "Y"
}
if (ovar == "Race"){
ovar <- "race"
legend <- "Y"
}
if (ovar == "Ethnicity"){
ovar <- "ethnicity"
legend <- "Y"
}
if (ovar == "Language"){
ovar <- "language"
legend <- "Y"
}
if (ovar == "Insurance Class"){
ovar <- "insurance"
legend <- "Y"
}
if (ovar == "Alcohol Use Disorder"){
ovar <- "alcohol"
legend <- "Y"
}
if (ovar == "Depression Diagnosis"){
ovar <- "depression"
legend <- "Y"
}
if (ovar == "Tobacco Use"){
ovar <- "tobacco"
legend <- "Y"
}
print("eey")
print(ovar)
print("oe")
print(names(data))
d <- data[!is.na(data[,ovar]),]
print("here")
lev <- levels(d[,ovar])
nps <- rep(NA, length(lev))
for (i in 1:length(lev)){
nps[i] <- length(unique(d$mrn[d[,ovar]==lev[i]]))
}
times <- list()
d <- d[d$covid=="Y",]
for (i in 1:length(lev)){
times[[i]] <- d$time[d[,ovar]==lev[i]]
}
names(times) <- lev
# extract dates #
d1 <- dr[1]
d2 <- dr[2]
d1 <- as.POSIXct(d1, format="%y-%m-%d")
d2 <- as.POSIXct(d2, format="%y-%m-%d")
data <- data[data$date >= d1 & data$date <= d2,]
dates <- unique(as.character(sort(data$date), format="%m/%Y"))
if (ovar=="center"){
plot_surv(times, nps, dates, ovar, ylim=ylim, lx="bottomleft", leg=F)
}else{
plot_surv(times, nps, dates, ovar, ylim=ylim, lx="bottomleft", leg=T)
}
}
runApp()
print(d)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
data_vaccination
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp('C:/Users/19708/Desktop/APCA/R/skeletons/Shiny/persistent')
runApp('C:/Users/19708/Desktop/data_portal')
shiny::runApp('C:/Users/19708/Desktop/APCA/R/skeletons/Shiny/persistent')
runApp()
# End Trading Routine #
# $$$$$$$$$$$$$$$$$$$ #
pause_foot(ni, i, pause[2], units[2])
runApp()
runApp()
runApp()
runApp()
runApp('C:/Users/19708/Desktop/APCA/R/skeletons/Shiny/persistent')
shiny::runApp()
shiny::runApp()
rm(list=objects())
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
rm(list=objects())
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
# function to pull params
thetas <- pull_thetas("ETH")
runApp()
runApp()
# Existing code #
#' @param times
#' list of vectors;
#'    each vector stores encounter times;
#'    names(list) = variable names over which data is stratified
#' @param nps
#' (vector) number of patients associated with stratification variables
plot_surv <- function(times, nps, dates, var, ylim, lx, leg){
for (i in 1:length(times)){
sf <- surv_fun(times[[i]], nps[i])
# from nps and sf backout SE #
# Insert Plotting Code #
cols <- c("red", "green", "pink", "yellow", "#FF8000", "#80FF00", "cyan", "#0080FF", "#8000FF", "magenta", "#FF0080","blue")
lwd=4
if (i==1){
plot(sf[,1], sf[,3], ty="l", col=cols, ylim=ylim, xlab=NA, ylab=NA, main=paste("by", stringr::str_to_title(var)), xaxt="n")
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = "grey10") # Color
lines(c(-1, 50), c(0,0))
lines(c(-1, 50), c(0.10, 0.10))
lines(c(-1, 50), c(0.20, 0.20))
lines(c(-1, 50), c(0.30, 0.30))
lines(c(-1, 50), c(0.40, 0.40))
lines(c(-1, 50), c(0.50, 0.50))
lines(c(-1, 50), c(0.60, 0.60))
lines(c(-1, 50), c(0.70, 0.70))
lines(c(-1, 50), c(0.80, 0.80))
lines(c(-1, 50), c(0.90, 0.90))
lines(c(-1, 50), c(1, 1))
axis(1, at=1:length(dates), dates)
lines(sf[,1], sf[,3], col=cols[i], lwd=lwd)
name_v <- names(times)
if (isTRUE(leg)){
legend(
lx,
ly,
bg="grey10",
name_v,
cex = 1.25,
col=cols[1:length(name_v)],
lty=1,
lwd=4,
text.col=cols[1:length(name_v)]
)
}
}else{
lines(sf[,1], sf[,3], ty="l", col=cols[i], lwd=lwd)
}
}
}
# goof around with some survival analysis #
#' @param times vector of encounter times
#' @param np number of patients seen
surv_fun <- function(times, np){
df <- data.frame(
time = 1:max(times),
cov = rep(NA, length(1:max(times))),
sur = rep(NA, length(1:max(times)))
)
for (t in 1:max(times)){
df$cov[t] <- sum(na.omit(times==t))
}
for (t in max(times):1){
df$sur[t] <- (np-sum(df$cov[1:t]))/np
print(sum(df$cov[1:t]))
}
return(df)
}
runApp()
print(np-sum(df$cov[1:t]))
runApp()
runApp()
runApp()
runApp()
runApp()
hi <- sf$sur+1.96*se
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
#### Load Libraries and Helper Functions #####
{
library(shiny)
library(shinydashboard)
library(leaflet)
setwd("Rfunctions")
for (file in list.files()){
source(file)
}
setwd("../rds")
for (file in list.files()){
load(file)
}
setwd("../")
}
str(data_covid$race)
str(data_vaccination)
str(data_vaccination$race)
str(data_vaccination$race)
str(data_telehealth$race)
data_covid$race <- as.character(data_covid$race)
data_vaccination$race <- as.character(data_vaccination$race)
data_telehealth$race <- as.character(data_telehealth$race)
data_covid$race[data_covid$race=="Native"] <- "Native Alaskan"
data_vaccination$race[data_vaccination$race=="Native"] <- "Native Alaskan"
data_telehealth$race[data_telehealth$race=="Native"] <- "Native Alaskan"
unique(data_covid$race)
l <- c("White", "Native Alaskan", "Asian", "Black", "Other")
l <- c("White", "Native Alaskan", "Asian", "Black", "Other")
data_covid$race <- factor(data_covid$race, levels = l)
data_vaccination$race <- factor(data_covid$race, levels = l)
data_vaccination$race <- factor(data_vaccination$race, levels = l)
data_telehealth$race <- factor(data_telehealth$race, levels=l)
choose.dir
choose.dir()
setwd("C:/Users/19708/Desktop/data_portal/rds")
setwd("C:/Users/19708/Desktop/data_portal/rds")
save(data_covid, file = "covid.rds")
save(data_vaccination, file = "vaccination.rds")
save(data_telehealth, file = "telehealth.rds")
runApp('C:/Users/19708/Desktop/data_portal')
data_covid
data_covid[,3]
data_vaccination[,3]
data_telehealth[,3]
data_vaccination$[,6]
data_vaccination[,6]
data_covid[,-3]
data_covid <- data_covid[,-3]
data_vaccination <- data_vaccination[,-6]
data_telehealth <- data_telehealth[,-3]
getwd()
save(data_covid, file = "covid.rds")
save(data_vaccination, file = "vaccination.rds")
save(data_telehealth, file = "telehealth.rds")
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
runApp('C:/Users/19708/Desktop/data_portal')
